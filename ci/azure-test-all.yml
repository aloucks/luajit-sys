steps:
  - checkout: self
    submodules: true
  - bash: |
      set -e -x
      cargo +stable fmt --all -- --check
    displayName: Check formatting
  - bash: |
      set -e -x
      cargo test --no-run
    displayName: Build everything
    env:
      RUST_BACKTRACE: 1
      CARGO_INCREMENTAL: 0
  - bash: |
      set -e -x
      cargo test
    displayName: Run unit tests
    env:
      RUST_BACKTRACE: 1
      CARGO_INCREMENTAL: 0
  - bash: |
      pwd
      find ./target
    displayName: List files in ./target
    condition: always()
